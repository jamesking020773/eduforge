{% extends "users/layout.html" %}
{% load static %}
{% block body %}
<div class="wrapper">
    <div id="sidebar" class="sidebar">    
        <!-- List of learning areas -->
        {% for learning_area, subjects in learning_areas_with_subjects.items %}
            <div class="learning-area">
                <a href="#" class="learning-area-link">{{ learning_area }}</a>
                <div class="subjects hidden">
                    {% for subject in subjects %}
                        <a href="#" class="subject-link" data-subject-id="{{ subject.id }}">{{ subject }}</a>
                    {% endfor %}
                </div>
            </div>
        {% endfor %}
    </div>
    <div id="content" class="content">
        <button id="toggleSidebar" style="border: none; background: none; padding: 0; margin: 5px;">
            <img src="{% static 'users/toggle.png' %}" alt="Toggle Sidebar" style="width: 25px; height: 25px;">
        </button>
        <!-- Content will be loaded here based on the selected subject -->
        <h2>Select a subject to view topics</h2>
    </div>
</div>
<script>
    document.querySelectorAll('.delete-button').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const confirmed = confirm('Are you sure you want to delete this item?');
            if (confirmed) {
                fetch(this.getAttribute('data-href'), {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}',
                    },
                }).then(response => {
                    if (response.ok) {
                        window.location.href = '{% url 'textbook:test' %}';
                    }
                });
            }
        });
    });

    document.getElementById('toggleSidebar').addEventListener('click', function() {
        var sidebar = document.getElementById('sidebar');
        var content = document.getElementById('content');
        sidebar.classList.toggle('collapsed');
        if (sidebar.classList.contains('collapsed')) {
            sidebar.style.width = '0px';
            content.style.width = '100%';
        } else {
            sidebar.style.width = '20%';
            content.style.width = '80%';
        }
    });

    // Toggle display of subjects under a learning area
    document.querySelectorAll('.learning-area > a').forEach(areaLink => {
        areaLink.addEventListener('click', function(e) {
            e.preventDefault();
            // Find the next sibling div which contains the subjects, and toggle its visibility
            var subjectsDiv = this.nextElementSibling;
            subjectsDiv.classList.toggle('hidden');
        });
    });

    // Event listener for subject links
    document.querySelectorAll('.subject-link').forEach(subjectLink => {
        subjectLink.addEventListener('click', function(e) {
            e.preventDefault();
            var subjectId = this.getAttribute('data-subject-id');
            // Here you would load the subject's topics into the content area.
            // This example just changes the text in the content area for demonstration.
            var contentArea = document.getElementById('content');
            contentArea.innerHTML = `<h2>Topics for Subject ID: ${subjectId}</h2>`;
            // You might make an AJAX call here to load the topics from the server based on the subjectId
            // and then dynamically update the contentArea.innerHTML with the response data.
        });
    });
</script>
{% endblock %}